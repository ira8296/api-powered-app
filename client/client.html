<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Hero Central</title>
        <link rel="stylesheet" type="text/css" href="./style.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
        <script type="text/babel">
            let primaryPowers = ["Superstrength",
                                "Speed",
                                "Durability",
                                "Agility/reflexes",
                                "Healing/regeneration",
                                "Supersenses"];

            let secondaryPowers = ["Climbing/wall-crawling",
                                   "Swimming/water-breathing",
                                   "Flight",
                                   "Teleportation",
                                   "Exceptional leaping",
                                   "Phasing/intangibility",
                                   "Temporal manipulation",
                                   "Time travel",
                                   "Prophecy",
                                   "Basic elements (fire, water and/or ice, earth, wind)",
                                   "Electricity",
                                   "Light",
                                   "Darkness and/or shadows",
                                   "Gravity",
                                   "Magnetic forces",
                                   "Radiation",
                                   "Energy",
                                   "Sound",
                                   "Nature",
                                   "Psychic",
                                   "Acid/poison",
                                   "Controlling plants and/or animals",
                                   "Shapeshifting (animals)",
                                   "Shapeshifting (people)",
                                   "Elasticity",
                                   "Self-destruction",
                                   "Self-liquification",
                                   "Gaseous form",
                                   "Growth/shrinking",
                                   "Self-duplication",
                                   "Invisibility",
                                   "Absorbing someone else’s powers",
                                   "Negating someone else’s powers",
                                   "Luck manipulation",
                                    "Illusions"];

            let powerSelectI = document.querySelector("#powerSelect1");
            let powerSelectII = document.querySelector("#powerSelect2");

            for(let p of primaryPowers){
                let option = document.createElement("option");
                option.value = p;
                option.innerHTML = p;
                powerSelectI.appendChild(option);
            }

            for(let p of secondaryPowers){
                let option = document.createElement("option");
                option.value = p;
                option.innerHTML = p;
                powerSelectII.appendChild(option);
            }

            function uploadFile(file){
                var url = '../src/index.php';
                var xhr = new XMLHttpRequest();
                var fd = new FormData();
                xhr.open("POST", url, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // Every thing ok, file uploaded
                        console.log(xhr.responseText); // handle response.
                    }
                };
                fd.append("upload_file", file);
                xhr.send(fd);
            }

            document.querySelector("#fileDrop").addEventListener('change', function(){
                uploadFile(this.File);
            }, false);

            const reponseHandler = (xhr, parseResponse) => {
            const status = document.querySelector("#message");

                switch(xhr.status) {
                    case 200:
                        status.innerHTML = `<b>Search Successful</b>`;
                        break;
                    case 201:
                        status.innerHTML = `<b>Created successfully</b>`;
                        break;
                    case 204:
                        status.innerHTML = `<b>Heroes Updated</b>`;
                        break;
                    case 400:
                        status.innerHTML = `<b>Bad Request</b>`;
                        break;
                    case 404:
                        status.innerHTML = `<b>Resource Not Found</b>`;
                        break;
                    default:
                        status.innerHTML = `<b>Error code has not been implemented</b>`;
                        break;
                }

                if(parseResponse) {
                    const obj = JSON.parse(xhr.response);
                    console.dir(obj);

                    status.innerHTML += `<p>${xhr.response}</p>`;
                }
            };

            const requestUpdate = (e, userForm) => {
                const url = userForm.querySelector("#urlField").value;
                const method = userForm.querySelector("#methodSelect").value;
        
                const xhr = new XMLHttpRequest();

                xhr.open(method, url);

                xhr.setRequestHeader('Accept', 'application/json');

                if(method == 'get'){
                    xhr.onload = () => reponseHandler(xhr, true);
                }
                else{
                    xhr.onload = () => reponseHandler(xhr, false);
                }

                xhr.send();

                e.preventDefault();

                return false;
            };

            const requestSearch = (e, searchForm) => {
                const input = searchForm.querySelector("input").value;
                const searchMethod = searchForm.getAttribute('method');
                
                const xhr = new XMLHttpRequest();
                
                xhr.open(searchMethod, input);
                xhr.setRequestHeader('Accept', 'application/json');
                xhr.onload = () => reponseHandler(xhr, true);
                
                xhr.send();

                e.preventDefault();
                
                return false;
            };

            const sendPost = (e, nameForm) => {
                e.preventDefault();

                const nameAction = nameForm.getAttribute('action');
                const nameMethod = nameForm.getAttribute('method');

                const nameField = nameForm.querySelector('#nameField');
                const heroField = nameForm.querySelector('#heroField');
                const imgField = document.querySelector("#fileDrop");
                const ageField = nameForm.querySelector('#ageField');
                const powerSelect1 = nameForm.querySelector('#powerSelect1');
                const powerSelect2 = nameForm.querySelector('#powerSelect2');
                
                const xhr = new XMLHttpRequest();
                xhr.open(nameMethod, nameAction);

                xhr.setRequestHeader('Accept', 'application/json');
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');

                xhr.onload = () => reponseHandler(xhr, true);
                
                let img = document.createElement("img");

                const formData = `realName=${nameField.value}&heroName=${heroField.value}&age=${ageField.value}&power1=${powerSelect1.value}&power2=${powerSelect2.value}&image=${}`;
                xhr.send(formData);

                return false;
            };

            const init = () => {
                
            };

            window.onload = init;
        </script>
    </head>
    <body>
        <section id="menu">
            <h1>Hero Central</h1>
            <form id="nameForm" action="/addUser" method="post">
              <label for="hero">Hero Name: </label>
              <input id="heroField" type="text" name="hero" />
              <label for="name">Real Name: </label>
              <input id="nameField" type="text" name="name" />
              <label for="age">Age: </label>
              <input id="ageField" type="number" name="age" min="0" max="100" step="1"/>
              <label for="supportPower">Support Power: </label>
              <select id="powerSelect1" name="supportPower">
              </select>
              <label for="mainPower">Main Power: </label>
              <select id="powerSelect2" name="mainPower">
              </select>
              <input type="file" id="fileDrop" />
              <input type="submit" value="Add User" />
            </form>
            <form id="userForm" action="/getUsers" method="get">
              <select id='urlField'>
                <option value='/getUsers'>/getUsers</option>
                <option value='/notReal'>/notReal</option>
              </select>
              <select id="methodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
              </select>
              <input type="submit" value="Get User" />
            </form>
            <form id="searchForm" action="/searchUsers" method="get">
                <input type="text" value="Search for a hero">
                <button>Search</button>
            </form>
            <p id="message"></p>
        </section>
        <section id="content">
        </section>
    </body>
</html>